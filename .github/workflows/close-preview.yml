name: Close a preview taxonomy in the ICC

on:
  pull_request:
    types: [closed]

env:
  # Put the ICC URL here
  ICC_URL: https://icc.plt

jobs:
  close-preview:
    permissions:
      contents: read
      pull-requests: read

    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Use Node.js 20
      uses: actions/setup-node@v4
      with:
        node-version: 20

    - name: Install the tug
      run: |
        curl -o tug https://storage.googleapis.com/downloads-platformatichq-com-downloads-443ac65b/dev/tug-linux-v1
        chmod +x tug

    - name: Merge a preview taxonomy in the ICC
      if: github.event.pull_request.merged == true
      run: ./tug close --merge --ci=github --reject-unauthorized=false --icc-url=$ICC_URL
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Close a preview taxonomy in the ICC
      if: github.event.pull_request.merged == false
      run: ./tug close --ci=github --reject-unauthorized=false --icc-url=$ICC_URL
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}